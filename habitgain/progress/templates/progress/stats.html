{% extends "base.html" %}
{% block content %}

<div class="d-flex justify-content-between align-items-center mb-4">
  <div>
    <h2 class="mb-1">Estadísticas y Rachas</h2>
    <p class="text-muted mb-0">Visualiza tu progreso histórico y tu racha actual.</p>
  </div>
  <div class="d-flex gap-2">
    <a class="btn btn-outline-secondary rounded-pill" href="{{ url_for('progress.panel') }}">
      <i class="bi bi-arrow-left"></i> Volver al panel
    </a>
  </div>
</div>

<div class="row g-3 mb-4">
  <div class="col-md-4">
    <div class="card glass h-100">
      <div class="card-body">
        <h6 class="text-muted">Racha Actual</h6>
        <div class="display-5 fw-bold">{{ current_streak }}<span class="fs-6 ms-1">días</span></div>
        {% if current_streak_habit_name %}
        <p class="text-muted mb-0 small">En tu hábito: <strong>{{ current_streak_habit_name }}</strong></p>
        {% else %}
        <p class="text-muted mb-0 small">Aún no tienes una racha activa. Hoy puede ser el día 1 ✨</p>
        {% endif %}
      </div>
    </div>
  </div>
  <div class="col-md-4">
    <div class="card glass h-100">
      <div class="card-body">
        <h6 class="text-muted">Mejor Racha Histórica</h6>
        <div class="display-5 fw-bold">{{ best_streak }}<span class="fs-6 ms-1">días</span></div>
        <p class="text-muted mb-0 small">Tu récord personal de constancia. ¿Listo para superarlo?</p>
      </div>
    </div>
  </div>
  <div class="col-md-4">
    <div class="card glass h-100">
      <div class="card-body">
        <h6 class="text-muted">Tasa de Cumplimiento ({{ window_days_30 }} días)</h6>
        <div class="display-5 fw-bold">{{ compliance_rate_30 }}<span class="fs-6 ms-1">%</span></div>
        <p class="text-muted mb-0 small">Has cumplido al menos un hábito en <strong>{{ success_days_30 }}</strong> de los últimos {{ window_days_30 }} días.</p>
      </div>
    </div>
  </div>
</div>

<div class="card glass mb-4">
  <div class="card-body">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h5 class="mb-0">Calendario de Hábitos - {{ month_name|capitalize }} {{ year }}</h5>
      <div class="d-flex gap-2 align-items-center small text-muted">
        <span class="calendar-legend completed"></span> Día cumplido
        <span class="calendar-legend missed ms-3"></span> Día no cumplido
        <span class="calendar-legend future ms-3"></span> Día futuro
      </div>
    </div>

    <div class="stats-calendar">
      <div class="calendar-header d-flex mb-2 text-muted small">
        {% for weekday in ["L", "M", "X", "J", "V", "S", "D"] %}
        <div class="calendar-cell calendar-cell-header flex-fill text-center">{{ weekday }}</div>
        {% endfor %}
      </div>
      {% for week in month_weeks %}
      <div class="d-flex mb-1">
        {% for day in week %}
        {% set d = day.date %}
        {% set status = day.status %}
        <div class="calendar-cell flex-fill text-center {{ 'other-month' if not day.in_month else status }}">
          <span class="calendar-day-number">{{ d.day }}</span>
        </div>
        {% endfor %}
      </div>
      {% endfor %}
    </div>
  </div>
</div>

{% endblock %}
